<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Afrok√≥dico Nexus - Plataforma Social & Educacional</title>
    
    <!-- Bibliotecas Essenciais -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Fontes Google -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

    <!-- Configura√ß√£o do Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        afro: {
                            dark: '#0f172a',
                            card: 'rgba(30, 41, 59, 0.7)',
                            primary: '#00d2ff',
                            secondary: '#3a7bd5',
                            accent: '#ff0055',
                            gold: '#ffd700'
                        }
                    },
                    fontFamily: {
                        orbitron: ['Orbitron', 'sans-serif'],
                        roboto: ['Roboto', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        /* Estilos Globais */
        body { 
            font-family: 'Roboto', sans-serif; 
            background: linear-gradient(135deg, #1e1b4b 0%, #0f172a 100%); 
            color: #e2e8f0; 
            margin: 0; 
            padding: 0;
            min-height: 100vh;
        }
        
        .glass {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .neon-text { text-shadow: 0 0 10px rgba(0, 210, 255, 0.5); }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 15px rgba(0, 210, 255, 0.2); }
            50% { box-shadow: 0 0 25px rgba(0, 210, 255, 0.5); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-ai { animation: pulse-glow 2s infinite; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        /* Loading Screen */
        #loading-msg {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #00d2ff;
            font-family: 'Orbitron', sans-serif;
            flex-direction: column;
            gap: 1rem;
        }
    </style>
</head>
<body>

    <div id="root">
        <div id="loading-msg">
            <i class="fas fa-circle-notch fa-spin fa-3x"></i>
            <p>Sincronizando Nexus...</p>
        </div>
    </div>

    <!-- Script de Prote√ß√£o contra Erros -->
    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            console.error("Erro Detectado:", message);
            const root = document.getElementById('root');
            if (root) {
                root.innerHTML = `
                    <div style="padding: 20px; color: #ff9999; background: #1a1a2e; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
                        <h2 style="font-family: 'Orbitron', sans-serif; font-size: 24px; margin-bottom: 15px; color: #ff5555;">Diagn√≥stico de Erro</h2>
                        <p style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; font-family: monospace;">${message}</p>
                        <button onclick="window.location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #00d2ff; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">Reiniciar Sistema</button>
                    </div>
                `;
            }
        };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- DADOS INICIAIS CORRIGIDOS ---
        // CORRE√á√ÉO CR√çTICA: Adicionado 'comments: []' ao terceiro item para evitar crash no .length
        const initialPosts = [
            { 
                id: 1, 
                user: "DalaDev", 
                avatar: "https://i.pravatar.cc/150?img=11", 
                type: "video", 
                content: "https://www.w3schools.com/html/mov_bbb.mp4", 
                title: "O Futuro da IA na √Åfrica", 
                category: "Tecnologia", 
                likes: 120, 
                comments: [], // Array existe
                isLive: false 
            },
            { 
                id: 2, 
                user: "AfroArtist", 
                avatar: "https://i.pravatar.cc/150?img=5", 
                type: "image", 
                content: "https://picsum.photos/800/600?random=1", 
                title: "Arte Generativa #04", 
                category: "Arte", 
                likes: 45, 
                comments: [], // Array existe
                isLive: false 
            },
            { 
                id: 3, 
                user: "CodeMaster", 
                avatar: "https://i.pravatar.cc/150?img=3", 
                type: "live", 
                content: "poster", 
                title: "üî¥ AULA AO VIVO: React Native", 
                category: "Educa√ß√£o", 
                viewers: 1542, 
                comments: [], // CORRE√á√ÉO: Adicionado campo faltante que causava o erro
                likes: 890,
                isLive: true 
            }
        ];

        // --- COMPONENTES ---

        const MenuButton = ({ icon, label, active, onClick, isLive }) => (
            <button onClick={onClick} className={`w-full text-left p-3 rounded-lg flex items-center transition-all ${active ? 'bg-afro-primary/20 text-afro-primary border border-afro-primary/50' : 'hover:bg-white/5 text-gray-300'}`}>
                <i className={`fas ${icon} w-8`}></i>
                <span className="flex-1 font-medium">{label}</span>
                {isLive && <span className="bg-red-500 text-white text-[10px] px-2 py-0.5 rounded animate-pulse font-bold">LIVE</span>}
            </button>
        );

        const Sidebar = ({ isOpen, toggle, activeTab, setTab, userStats }) => {
            return (
                <div className={`fixed top-0 left-0 h-full w-80 bg-slate-900 border-r border-white/10 z-50 transform transition-transform duration-300 shadow-2xl ${isOpen ? 'translate-x-0' : '-translate-x-full'}`}>
                    <div className="p-6 border-b border-white/10 flex justify-between items-center bg-slate-900">
                        <h2 className="text-2xl font-orbitron text-afro-primary neon-text">NEXUS</h2>
                        <button onClick={toggle} className="text-white hover:text-afro-accent p-2"><i className="fas fa-times text-xl"></i></button>
                    </div>
                    
                    <div className="p-6 text-center border-b border-white/10 bg-slate-800/50">
                        <img src="https://i.pravatar.cc/150?img=11" alt="Profile" className="w-20 h-20 rounded-full mx-auto border-2 border-afro-primary mb-3" />
                        <h3 className="font-bold text-white text-lg">Visitante Criativo</h3>
                        <div className="flex justify-center gap-2 mt-2 text-xs">
                            <span className="bg-afro-secondary px-2 py-1 rounded text-white font-bold">Lvl {userStats.level}</span>
                            <span className="bg-afro-gold text-slate-900 px-2 py-1 rounded font-bold">{userStats.coins} AKC</span>
                        </div>
                    </div>

                    <nav className="p-4 space-y-2 bg-slate-900 h-full">
                        <MenuButton icon="fa-home" label="Feed Social" active={activeTab === 'feed'} onClick={() => setTab('feed')} />
                        <MenuButton icon="fa-graduation-cap" label="Educa√ß√£o & IA" active={activeTab === 'edu'} onClick={() => setTab('edu')} />
                        <MenuButton icon="fa-cloud-upload-alt" label="Est√∫dio de Upload" active={activeTab === 'upload'} onClick={() => setTab('upload')} />
                        <MenuButton icon="fa-video" label="Live Streaming" active={activeTab === 'live'} onClick={() => setTab('live')} isLive={true} />
                        <MenuButton icon="fa-gem" label="Premium & Monetiza√ß√£o" active={activeTab === 'premium'} onClick={() => setTab('premium')} />
                    </nav>

                    <div className="absolute bottom-0 w-full p-4 border-t border-white/10 text-center text-xs text-gray-500 bg-slate-900">
                        <p>Afrok√≥dico Engine v3.3</p>
                        <p>Luanda, Angola</p>
                    </div>
                </div>
            );
        };

        const UploadStudio = ({ onUpload }) => {
            const [analyzing, setAnalyzing] = useState(false);
            const [file, setFile] = useState(null);
            const [tags, setTags] = useState([]);

            const handleFileChange = (e) => {
                const selected = e.target.files[0];
                if (selected) {
                    setFile(selected);
                    setAnalyzing(true);
                    setTimeout(() => {
                        setAnalyzing(false);
                        setTags(['#Natureza', '#4K', '#AfroFuturismo', '#Detectado:Paisagem']);
                    }, 2000);
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!file) return;
                
                const newPost = {
                    id: Date.now(),
                    user: "Visitante Criativo",
                    avatar: "https://i.pravatar.cc/150?img=11",
                    type: file.type.includes('video') ? 'video' : 'image',
                    content: URL.createObjectURL(file),
                    title: "Novo Upload via Nexus",
                    category: "Geral",
                    likes: 0,
                    comments: []
                };
                onUpload(newPost);
                alert("Conte√∫do publicado com sucesso!");
                setFile(null);
                setTags([]);
            };

            return (
                <div className="glass p-8 rounded-2xl max-w-2xl mx-auto mt-10 animate-fade-in border border-white/10">
                    <h2 className="text-2xl font-orbitron mb-6 text-center text-afro-primary">Est√∫dio Neural</h2>
                    
                    <div className="border-2 border-dashed border-gray-500 rounded-xl p-10 text-center hover:border-afro-primary transition-colors cursor-pointer relative bg-slate-800/50">
                        <input type="file" onChange={handleFileChange} className="absolute inset-0 opacity-0 cursor-pointer" accept="image/*,video/*" />
                        <i className="fas fa-cloud-upload-alt text-5xl text-gray-400 mb-4"></i>
                        <p className="text-gray-300 font-medium">Toque para selecionar arquivos</p>
                    </div>

                    {analyzing && (
                        <div className="mt-6 flex items-center justify-center gap-3 text-afro-primary font-bold">
                            <i className="fas fa-brain animate-pulse"></i>
                            <span>IA Vision processando...</span>
                        </div>
                    )}

                    {!analyzing && file && (
                        <div className="mt-6 animate-fade-in">
                            <div className="bg-slate-800 p-4 rounded-lg flex items-center gap-4 border border-white/5">
                                <i className="fas fa-check-circle text-green-500"></i>
                                <span className="text-sm truncate text-white">{file.name}</span>
                            </div>
                            <button onClick={handleSubmit} className="w-full mt-4 bg-gradient-to-r from-afro-secondary to-afro-primary text-slate-900 font-bold py-3 rounded-lg hover:opacity-90 transition">
                                Publicar na Blockchain
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        const MediaCard = ({ post, onLike }) => {
            // PROTE√á√ÉO: Garante que comments n√£o seja undefined antes de ler .length
            const commentsCount = (post.comments && post.comments.length) ? post.comments.length : 0;
            const likesCount = post.likes || 0;

            return (
                <div className="glass rounded-xl overflow-hidden mb-6 transition hover:bg-slate-800/40 duration-300 border border-white/5">
                    <div className="p-4 flex items-center justify-between">
                        <div className="flex items-center gap-3">
                            <img src={post.avatar} className="w-10 h-10 rounded-full border border-afro-primary" alt="Avatar" />
                            <div>
                                <h4 className="font-bold text-sm text-white">{post.user}</h4>
                                <span className="text-xs text-gray-400">H√° 2 min ‚Ä¢ {post.category}</span>
                            </div>
                        </div>
                        <button className="text-gray-400 hover:text-white p-2"><i className="fas fa-ellipsis-v"></i></button>
                    </div>

                    <div className="w-full bg-black relative flex items-center justify-center bg-slate-900 min-h-[200px]">
                        {post.isLive ? (
                            <div className="w-full h-64 flex items-center justify-center bg-gray-900 relative">
                                <span className="absolute top-4 left-4 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded animate-pulse z-10">AO VIVO</span>
                                <i className="fas fa-play-circle text-6xl text-white/50"></i>
                            </div>
                        ) : post.type === 'video' ? (
                            <video src={post.content} controls className="w-full max-h-[500px] object-contain bg-black"></video>
                        ) : (
                            <img 
                                src={post.content} 
                                className="w-full h-auto max-h-[500px] object-cover" 
                                alt={post.title} 
                                onError={(e) => {e.target.onerror = null; e.target.src="https://placehold.co/800x400?text=Imagem+Carregando";}} 
                            />
                        )}
                    </div>

                    <div className="p-4">
                        <div className="flex justify-between items-center mb-3">
                            <div className="flex gap-4">
                                <button onClick={() => onLike(post.id)} className="text-gray-300 hover:text-afro-accent transition flex items-center gap-2 group">
                                    <i className={`${likesCount > 0 ? 'fas text-afro-accent' : 'far'} fa-heart group-hover:scale-110 transition-transform`}></i> 
                                    <span>{likesCount}</span>
                                </button>
                                <button className="text-gray-300 hover:text-afro-primary transition flex items-center gap-2">
                                    <i className="far fa-comment"></i> 
                                    {/* CORRE√á√ÉO: Usando a vari√°vel segura commentsCount */}
                                    <span>{commentsCount}</span>
                                </button>
                                <button className="text-gray-300 hover:text-green-400 transition">
                                    <i className="fas fa-share-alt"></i>
                                </button>
                            </div>
                            <button className="text-gray-300 hover:text-afro-gold">
                                <i className="far fa-bookmark"></i>
                            </button>
                        </div>
                        <h3 className="font-bold text-lg mb-1 text-white">{post.title}</h3>
                        {post.isLive && <p className="text-sm text-red-400 font-bold">{post.viewers} spectadores</p>}
                    </div>
                </div>
            );
        };

        const MonetizationHub = () => (
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 animate-fade-in">
                <div className="glass p-6 rounded-xl md:col-span-3 flex flex-col md:flex-row justify-between items-center bg-gradient-to-r from-slate-900 to-slate-800 border border-white/10">
                    <div className="mb-4 md:mb-0 text-center md:text-left">
                        <h3 className="text-gray-400 text-sm font-bold uppercase tracking-wider">Saldo na Carteira</h3>
                        <div className="text-4xl font-orbitron text-afro-gold mt-1 drop-shadow-lg">1,240.50 AKC</div>
                        <div className="text-xs text-green-400 mt-1 font-bold"><i className="fas fa-arrow-up"></i> +12% esta semana</div>
                    </div>
                    <button className="bg-afro-primary text-slate-900 px-8 py-3 rounded-lg font-bold hover:bg-white transition shadow-lg shadow-afro-primary/30">
                        <i className="fas fa-university mr-2"></i> Sacar Fundos
                    </button>
                </div>

                <div className="glass p-6 rounded-xl border-t-4 border-afro-primary relative transform md:scale-105 shadow-2xl bg-slate-800">
                    <span className="absolute -top-3 right-4 bg-afro-primary text-slate-900 text-xs font-extrabold px-3 py-1 rounded-full uppercase">Melhor Escolha</span>
                    <h3 className="text-xl font-bold mb-2 text-white">Nexus Pro</h3>
                    <ul className="text-sm text-gray-300 space-y-3 mb-6">
                        <li className="flex items-center"><i className="fas fa-check text-afro-primary mr-2"></i> Uploads 4K & VR</li>
                        <li className="flex items-center"><i className="fas fa-check text-afro-primary mr-2"></i> Zero an√∫ncios</li>
                    </ul>
                    <button className="w-full py-3 bg-afro-primary text-slate-900 font-bold rounded hover:bg-white transition shadow-lg shadow-afro-primary/20">Assinar (20 AKC)</button>
                </div>
            </div>
        );

        const EduSection = () => (
            <div className="space-y-6 animate-fade-in">
                <div className="glass p-6 rounded-xl flex flex-col md:flex-row gap-6 items-center border border-white/10">
                    <div className="flex-1">
                        <span className="bg-afro-secondary/20 text-afro-secondary text-xs px-2 py-1 rounded mb-2 inline-block border border-afro-secondary/30 font-bold">Machine Learning</span>
                        <h2 className="text-2xl font-bold mb-2 text-white">Introdu√ß√£o √† IA Generativa</h2>
                        <p className="text-gray-300 text-sm mb-4 leading-relaxed">Domine a cria√ß√£o de modelos digitais usando Python e TensorFlow.</p>
                        <div className="w-full bg-gray-700 rounded-full h-2 mb-2">
                            <div className="bg-afro-primary h-2 rounded-full shadow-[0_0_10px_#00d2ff]" style={{width: '45%'}}></div>
                        </div>
                        <button className="bg-white text-slate-900 px-6 py-2 rounded font-bold hover:bg-gray-200 transition">Continuar Aula</button>
                    </div>
                </div>
            </div>
        );

        const App = () => {
            const [sidebarOpen, setSidebarOpen] = useState(false);
            const [activeTab, setActiveTab] = useState('feed');
            const [posts, setPosts] = useState(initialPosts);
            const [searchTerm, setSearchTerm] = useState("");
            const [userStats, setUserStats] = useState({ level: 5, coins: 2500 });
            const [isReady, setIsReady] = useState(false);

            useEffect(() => {
                setIsReady(true);
            }, []);

            const handleUpload = (newPost) => {
                setPosts([newPost, ...posts]);
                setActiveTab('feed');
                setUserStats({ ...userStats, coins: userStats.coins + 50 });
            };

            const handleLike = (id) => {
                setPosts(posts.map(p => p.id === id ? { ...p, likes: p.likes + 1 } : p));
            };

            // Filtragem Segura
            const filteredPosts = posts.filter(p => {
                const title = p.title ? p.title.toLowerCase() : "";
                const category = p.category ? p.category.toLowerCase() : "";
                const search = searchTerm.toLowerCase();
                return title.includes(search) || category.includes(search);
            });

            if (!isReady) return null;

            return (
                <div className="min-h-screen text-gray-100 pb-20 md:pb-0">
                    
                    {/* Header */}
                    <header className="fixed top-0 w-full glass z-40 px-4 py-3 flex justify-between items-center shadow-lg border-b border-white/10">
                        <div className="flex items-center gap-4">
                            <button onClick={() => setSidebarOpen(true)} className="text-white text-xl hover:text-afro-primary transition p-2">
                                <i className="fas fa-bars"></i>
                            </button>
                            <h1 className="font-orbitron text-xl md:text-2xl text-transparent bg-clip-text bg-gradient-to-r from-afro-primary to-afro-secondary hidden sm:block font-bold">
                                AFROK√ìDICO
                            </h1>
                        </div>
                        <div className="flex-1 max-w-md mx-4 relative">
                            <input 
                                type="text" 
                                placeholder="Pesquisar..." 
                                className="w-full bg-slate-800/50 border border-white/10 rounded-full py-2 px-10 text-sm text-white focus:outline-none focus:border-afro-primary focus:bg-slate-800 transition placeholder-gray-500"
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                            <i className="fas fa-search absolute left-4 top-2.5 text-gray-400"></i>
                        </div>
                    </header>

                    <Sidebar 
                        isOpen={sidebarOpen} 
                        toggle={() => setSidebarOpen(false)} 
                        activeTab={activeTab} 
                        setTab={(tab) => { setActiveTab(tab); setSidebarOpen(false); }}
                        userStats={userStats}
                    />
                    
                    {sidebarOpen && <div className="fixed inset-0 bg-black/80 z-40 backdrop-blur-sm transition-opacity" onClick={() => setSidebarOpen(false)}></div>}

                    <main className="pt-24 px-4 max-w-5xl mx-auto min-h-screen">
                        
                        {activeTab === 'feed' && (
                            <div className="animate-fade-in">
                                <div className="flex gap-4 overflow-x-auto pb-4 mb-6 scrollbar-hide">
                                    {['Live', 'Tech', 'Music'].map((story, i) => (
                                        <div key={i} className="flex-shrink-0 flex flex-col items-center gap-2 cursor-pointer group">
                                            <div className={`w-16 h-16 rounded-full p-[2px] ${i === 0 ? 'bg-red-500 animate-pulse' : 'bg-gradient-to-tr from-afro-primary to-afro-accent group-hover:scale-105 transition-transform'}`}>
                                                <div className="w-full h-full bg-slate-900 rounded-full border-2 border-slate-900 overflow-hidden">
                                                    <img src={`https://picsum.photos/100/100?random=${i+50}`} className="w-full h-full object-cover" />
                                                </div>
                                            </div>
                                            <span className="text-xs text-gray-300 font-medium">{story}</span>
                                        </div>
                                    ))}
                                </div>

                                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                    <div className="lg:col-span-2">
                                        {filteredPosts.map(post => (
                                            <MediaCard key={post.id} post={post} onLike={handleLike} />
                                        ))}
                                    </div>
                                    <div className="hidden lg:block space-y-6">
                                        <div className="glass p-5 rounded-xl border border-white/5">
                                            <h4 className="font-bold mb-4 text-afro-secondary flex items-center gap-2">
                                                <i className="fas fa-hashtag"></i> Tend√™ncias
                                            </h4>
                                            {['#AfroFuturismo', '#ReactJS', '#AngolaTech'].map(tag => (
                                                <div key={tag} className="flex justify-between items-center py-3 border-b border-white/5 last:border-0 hover:bg-white/5 px-2 -mx-2 rounded transition cursor-pointer">
                                                    <span className="text-sm text-gray-300 font-medium">{tag}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'upload' && <UploadStudio onUpload={handleUpload} />}
                        {activeTab === 'premium' && <MonetizationHub />}
                        {activeTab === 'edu' && <EduSection />}
                        {activeTab === 'live' && (
                             <div className="text-center py-20 animate-fade-in glass rounded-2xl border border-white/10 mt-6">
                                <h2 className="text-3xl font-bold mb-3 text-white">Est√∫dio de Transmiss√£o</h2>
                                <p className="text-gray-400 mb-8 max-w-md mx-auto">Sua audi√™ncia est√° esperando.</p>
                                <button className="bg-red-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-red-700 transition shadow-lg shadow-red-500/30">
                                    INICIAR AGORA
                                </button>
                             </div>
                        )}

                    </main>

                    <nav className="fixed bottom-0 w-full glass border-t border-white/10 md:hidden flex justify-around p-3 z-50 bg-slate-900/90 backdrop-blur-lg">
                        <button onClick={() => setActiveTab('feed')} className={`text-xl p-2 rounded-lg transition ${activeTab === 'feed' ? 'text-afro-primary bg-white/5' : 'text-gray-500'}`}><i className="fas fa-home"></i></button>
                        <button onClick={() => setActiveTab('upload')} className="bg-gradient-to-tr from-afro-primary to-afro-secondary text-slate-900 rounded-full w-14 h-14 flex items-center justify-center -mt-8 shadow-lg shadow-afro-primary/50 border-4 border-slate-900 transform active:scale-95 transition"><i className="fas fa-plus text-xl"></i></button>
                        <button onClick={() => setActiveTab('premium')} className={`text-xl p-2 rounded-lg transition ${activeTab === 'premium' ? 'text-afro-primary bg-white/5' : 'text-gray-500'}`}><i className="fas fa-wallet"></i></button>
                    </nav>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

